---
description: ApiResult pattern usage and error handling best practices
alwaysApply: false
---
# C# ApiResult Pattern

## Handler Return Pattern

**Always return ApiResult<T> from handlers:**

```csharp
// Success
    return ApiResult<RegisterUserResponse>.Success(new RegisterUserResponse { ... });
    
// Errors
return ApiResult<Response>.Conflict("Username already taken");
return ApiResult<Response>.Unauthorized("Invalid credentials");
return ApiResult<Response>.NotFound("User not found");
return ApiResult<Response>.ValidationError("Invalid input");
return ApiResult<Response>.Failure("Generic error");
```

## Error Type Selection

- **Conflict (409)**: Duplicate/resource conflicts (username taken, email registered)
- **Unauthorized (401)**: Authentication failures (invalid credentials)
- **NotFound (404)**: Resource doesn't exist
- **ValidationError (400)**: Business rule violations (input validation handled by FluentValidation)
- **Failure (400)**: Generic errors

## Endpoint Mapping

```csharp
[HttpPost]
public async Task<IActionResult> Handle([FromBody] Request request, CancellationToken cancellationToken)
{
    var result = await _handler.HandleAsync(request, cancellationToken);
    return ToActionResult(result);  // Auto-maps ApiResult → IActionResult
}
```

## Error Messages

**Provide clear, user-friendly messages:**
- ✅ "This username is already taken. Please choose a different one."
- ❌ "Duplicate key violation"

## Response Format

**Success:** `{ "Data": {...}, "Success": true }`  
**Error:** `{ "Message": "...", "ErrorCode": "Conflict" }`

## Exception Handling

**Catch expected exceptions and return ApiResult. Let ExceptionHandlingMiddleware handle unexpected exceptions.**
